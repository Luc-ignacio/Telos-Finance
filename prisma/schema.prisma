generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  avatar    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
  Wallets   Wallet[]
}

model Wallet {
  id           String        @id @default(uuid())
  name         String
  userId       String
  User         User          @relation(fields: [userId], references: [id])
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt()
  Holdings     Holding[]
  Transactions Transaction[]
}

enum AssetClass {
  EQUITY // Stocks, Ações
  FIXED_INCOME // Bonds, Renda Fixa, Tesouro Direto
  REAL_ESTATE // REITs, FIIs
  FUNDS // Mutual Funds, Managed Funds, Fundos de Investimento
  ETF // ETFs
  CASH // Cash, Saldo em Conta
  CRYPTO // BTC, ETH
}

enum AssetType {
  STOCK
  BOND
  GOV_BOND
  REIT
  FUND
  ETF
  CASH
  CRYPTO
}

enum CountryCode {
  AU
  BR
  US
}

enum CurrencyCode {
  AUD
  BRL
  USD
}

enum FixedIncomeIndexer {
  CDI // CDB, LCI, LCA pós-fixado
  SELIC // Tesouro Selic
  IPCA // Tesouro IPCA+
  FIXED_RATE // Tesouro Prefixado, CDB Prefixado
}

model Holding {
  id String @id @default(uuid())

  // Wallet Info
  walletId String
  Wallet   Wallet @relation(fields: [walletId], references: [id])

  // Asset Info
  name     String
  ticker   String?
  class    AssetClass
  type     AssetType?
  country  CountryCode
  currency CurrencyCode
  exchange String?

  // Financial Info
  quantity Decimal @default(0)
  avgPrice Decimal @default(0)

  // Fixed Income Info
  fixedIncomeIndexer      FixedIncomeIndexer?
  fixedIncomeRate         Decimal?
  fixedIncomePurchaseDate DateTime?
  fixedIncomeMaturityDate DateTime?

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt()
  Transactions Transaction[]

  @@unique([walletId, ticker])
  @@unique([walletId, name])
}

enum TransactionType {
  BUY
  SELL
  DIVIDEND
  INTEREST
  REDEMPTION
  MATURITY
}

model Transaction {
  id String @id @default(uuid())

  // Wallet Info
  walletId String
  Wallet   Wallet @relation(fields: [walletId], references: [id])

  // Holding Info
  holdingId String
  Holding   Holding @relation(fields: [holdingId], references: [id], onDelete: Cascade)

  // Financial Info
  type      TransactionType
  quantity  Decimal
  price     Decimal
  currency  CurrencyCode
  tradeDate DateTime

  createdAt DateTime @default(now())
}
